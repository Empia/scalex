#!/bin/sh

log () {
  echo -e "\x1b[7m[lila]\x1b[0m $1"
}

PLAY=../play-2.0.4/play
REMOTE="cook"
REMOTE_DIR="/home/scalex-http"

log "Deploy to $REMOTE:$REMOTE_DIR"

APP_NAME=scalex-http-1.0

$PLAY dist
if [ $? != 0 ]; then
  log "Deploy canceled"
  exit 1
fi
cd dist
rm -rf $APP_NAME
unzip $APP_NAME.zip
chmod +x $APP_NAME/start
cd ..

RSYNC_OPTIONS=" \
  --archive \
  --force \
  --delete \
  --progress \
  --compress \
  --checksum \
  --exclude logs \
  --exclude RUNNING_PID";

log "Rsync binaries"
rsync $RSYNC_OPTIONS dist/$APP_NAME/* $REMOTE:$REMOTE_DIR

log "Restart scalex-http"
ssh $REMOTE "service scalex-http restart"

log "Deploy complete"
